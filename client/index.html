<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Client WebRTC</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <style>
            video
            {
                width: 200px;
                height: 150px
            }
        </style>
    </head>
    <body>
        <div id="buttons">
            <button id="creatChannel">CreatDataChannel</button>
            <button id="joinChannel">JoinDataChannel</button>
            <button id="sendButton">Send</button>
            <button id="closeButton">Stop</button>
        </div>

        <div id="sendReceive">
            <div id="send">
                <h2>Send</h2>
                <textarea id="dataChannelSend"></textarea>
            </div>
            <div id="receive">
                <h2>Receive</h2>
                <textarea id="dataChannelReceive" disabled></textarea>
            </div>
        </div>
        <div class="video-wrapper">
            <video id="otherVideo"></video>
            <video id="ownVideo" ></video>
        </div>
        <script type="text/javascript" src="client.js"></script>
        <script>
            var localStream;
            var localVideo = document.getElementById("localVideo");
            var localPeerConnection, remotePeerConnection;
            var sendChannel, receiveChannel;
            var option;

            var creatChannelButton = document.getElementById("creatChannel");
            var joinChannelButton = document.getElementById("joinChannel");
            var sendButton = document.getElementById("sendButton");
            var closeButton = document.getElementById("closeButton");

            var ownVideo = document.getElementById('ownVideo');
            var otherVideo = document.getElementById('otherVideo');
            //            creatChannel.disabled = false;
            //            joinChannel.disabled = false;
            //            sendButton.disabled = true;
            //            closeButton.disabled = true;

            /*
             * creation de l'objet webRTC
             */
            var webRTC = new WebRTC();
            /*
             * connexion au serveur
             */
            webRTC.connectToSocket('ws://localhost:6969');

            document.addEventListener('socketEvent', function(socketEvent) {
                switch (socketEvent.eventType) {
                    case 'streamAdded':
                        // we receive the video-stream of our partner
                        // and play it on the video-element
                        otherVideo.src = URL.createObjectURL(webRTC.getOtherStream());
                        otherVideo.play();
                        break;
                }
            });

            creatChannelButton.addEventListener('click', function(e) {
                e.preventDefault();
                // private methode
                var success = function(myStream) {
                    ownVideo.src = URL.createObjectURL(myStream);
                    ownVideo.play();
                    // create a room
                    console.log("creatRoom");
                    webRTC.createRoom();
                };
                //var param = {audio:true,video:true};
                webRTC.getMedia(null, success);
            });

            joinChannelButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log("join room");
                //webRTC.joinRoom("bigueRobAir");
                // get media-stream
                var success = function(myStream) {

                    ownVideo.src = URL.createObjectURL(myStream);
                    ownVideo.play();
                    // join a room
                    webRTC.joinRoom("bigueRobAir");
                    //WebRTC.joinRoom(roomidInput.value);
                };
                //var param = {audio:true,video:true};
                webRTC.getMedia(null, success);
            });

            sendButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('send data');
                webRTC.sendData();
            });
        </script>
    </body>
</html>
